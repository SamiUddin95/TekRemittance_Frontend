<app-page-title [title]="getPageTitle()" subTitle="Users"></app-page-title>
<div class="">
  <form *ngIf="userForm" class="row g-3 aligned-form justify-content-evenly" [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <div class="col-12 col-md-7">
      <div class="card shadow-sm ">
        <div class="card-header bg-light border-bottom">
          <div class="d-flex justify-content-between align-items-center col-12"
            style="margin-top: -5px; margin-bottom: -5px;">
            <div class="d-flex align-items-center">
              <ng-icon name="tablerUser" class="me-2 gradient-icon" size="20"></ng-icon>
              <h4 class="card-title mb-0 text-dark">Info</h4>
            </div>
          </div>
        </div>
        <div class="card-body">
        <div class="row g-3">
            <div class="col-8">
              <div class="form-group">
                <div class="col-12 d-flex">
                  <div class="col-4">
                    <label for="name" class="form-label fw-semibold">
                      <ng-icon name="tablerUser" class="me-1 gradient-icon" size="16"></ng-icon>
                      Name <span class="text-danger">*</span>
                    </label>
                    @if (getFieldError('name')) { <div class="invalid-feedback">{{ getFieldError('name') }}</div> }
                  </div>
                  <div class="col-8">
                    <input type="text" id="name" class="form-control form-control"
                    [class.is-invalid]="getFieldError('name')" formControlName="name" maxlength="100" placeholder="Enter full name">
                  </div>
                </div>
              </div>
            </div>
            <div class="col-8">
              <div class="form-group">
                <div class="col-12 d-flex">
                  <div class="col-4"> 
                    <label for="email" class="form-label fw-semibold">
                      <ng-icon name="tablerMail" class="me-1 gradient-icon" size="16"></ng-icon>
                      Email <span class="text-danger">*</span>
                    </label>
                    @if (getFieldError('email')) { <div class="invalid-feedback">{{ getFieldError('email') }}</div> }
                  </div>
                  <div class="col-8">
                    <input type="email" id="email" class="form-control form-control"
                      [class.is-invalid]="getFieldError('email')" formControlName="email" maxlength="150" placeholder="name@example.com">
                  </div>
                </div>
              </div>
            </div>
            <div class="col-8">
              <div class="form-group">
                <div class="col-12 d-flex">
                  <div class="col-4"> 
                    <label for="phone" class="form-label fw-semibold">
                  <ng-icon name="tablerPhone" class="me-1 gradient-icon" size="16"></ng-icon>
                  Phone
                </label>
                @if (getFieldError('phone')) { <div class="invalid-feedback">{{ getFieldError('phone') }}</div> }
                </div>
                <div class="col-8">
                <input type="text" id="phone" class="form-control form-control"
                  [class.is-invalid]="getFieldError('phone')" formControlName="phone" maxlength="20" placeholder="03xx-xxxxxxx">
                </div>
                </div>
              </div>
            </div>
            <div class="col-8">
              <div class="form-group">
                <div class="col-12 d-flex">
                  <div class="col-4"> 
                  <label for="employeeId" class="form-label fw-semibold">
                  <ng-icon name="tablerId" class="me-1 gradient-icon" size="16"></ng-icon>
                  Employee Id <span class="text-danger">*</span>
                </label>
                @if (getFieldError('employeeId')) { <div class="invalid-feedback">{{ getFieldError('employeeId') }}</div> }
                </div>
                <div class="col-8">
                <input type="text" id="employeeId" class="form-control form-control"
                  [class.is-invalid]="getFieldError('employeeId')" formControlName="employeeId" maxlength="50" placeholder="EMP-00123">
                </div>
                </div>
              </div>
            </div>
            <div class="col-8">
              <div class="form-group">
                <div class="col-12 d-flex">
                  <div class="col-4"> 
                    <label for="userType" class="form-label fw-semibold">
                      <ng-icon name="tablerUsers" class="me-1 gradient-icon" size="16"></ng-icon>
                      User Type <span class="text-danger">*</span>
                    </label>
                    @if (getFieldError('userType')) { <div class="invalid-feedback">{{ getFieldError('userType') }}</div> }
                  </div>
                  <div class="col-8">
                    <select id="userType" class="form-select form-control" [class.is-invalid]="getFieldError('userType')" formControlName="userType">
                      <option value="">Select user type</option>
                      <option value="internalUser">Internal User</option>
                      <option value="branchUser">Branch User</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-8">
              <div class="form-group">
                <div class="col-12 d-flex">
                  <div class="col-4"> 
                <label for="limitType" class="form-label fw-semibold">
                  <ng-icon name="tablerGauge" class="me-1 gradient-icon" size="16"></ng-icon>
                  User Limit<span class="text-danger">*</span>
                </label>
                @if (getFieldError('limitType')) { <div class="invalid-feedback">{{ getFieldError('limitType') }}</div>}
                </div>
                <div class="col-8">
                <input type="number" id="limitType" class="form-control form-control"
                  [class.is-invalid]="getFieldError('limitType')" formControlName="limitType" placeholder="0">
                </div>
                </div>
              </div>
            </div>
            <div class="col-8 py-2">
              <div class="form-check form-switch">
                <div class="col-12 d-flex justify-content-between align-items-center">
                  <div class="col-5 d-flex justify-content-between">
                    <label for="isActive" class="form-label fw-semibold" >
                      Is Active
                    </label>
                    <input class="form-check-input form-check-input-lg me-1 ms-1" type="checkbox" id="isActive"
                      formControlName="isActive">
                  </div>
                  <div class="col-7 d-flex justify-content-evenly">
                  </div>
                </div>
              </div>
            </div>
          </div>


        </div>
      </div>
    </div>

    <div class="col-12 col-md-5">
      <div class="card shadow-sm credentials-card mb-5">
        <div class="card-header bg-light border-bottom">
          <div class="d-flex justify-content-between align-items-center col-12"
            style="margin-top: -5px; margin-bottom: -5px;">
            <div class="d-flex align-items-center">
              <ng-icon name="tablerKey" class="me-2 gradient-icon" size="20"></ng-icon>
              <h4 class="card-title mb-0 text-dark">Credentials</h4>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <div class="form-group">
                <div class="col-12 d-flex">
                  <div class="col-4"> 
                <label for="loginName" class="form-label fw-semibold">
                  <ng-icon name="tablerUser" class="me-1 gradient-icon" size="16"></ng-icon>
                  Login Name <span class="text-danger">*</span>
                </label>
                @if (getFieldError('loginName')) { <div class="invalid-feedback">{{ getFieldError('loginName') }}</div>}
                </div>
                <div class="col-8">
                <input type="text" id="loginName" class="form-control form-control"
                  [class.is-invalid]="getFieldError('loginName')" formControlName="loginName" maxlength="100" placeholder="Enter username">
                </div>
                </div>
            </div>
            </div>

            <div class="col-12">
              <div class="form-group">
                <div class="col-12 d-flex">
                  <div class="col-4"> 
                <label for="password" class="form-label fw-semibold">
                  <ng-icon name="tablerLock" class="me-1 gradient-icon" size="16"></ng-icon>
                  Password <span class="text-danger">*</span>
                </label>
                @if ((!isEditMode || showPasswordChange) && getFieldError('password')) { <div class="invalid-feedback">{{ getFieldError('password') }}</div> }
                </div>
                <div class="col-8">
                <input type="password" id="password" class="form-control form-control"
                  [class.is-invalid]="(!isEditMode || showPasswordChange) && getFieldError('password')" formControlName="password" maxlength="100" placeholder="Enter password">
                </div>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="form-group">
                <div class="col-12 d-flex">
                  <div class="col-4"> 
                <label for="confirmPassword" class="form-label fw-semibold">
                  <ng-icon name="tablerLockCheck" class="me-1 gradient-icon" size="16"></ng-icon>
                  Confirm Password <span class="text-danger">*</span>
                </label>
                @if ((!isEditMode || showPasswordChange) && getFieldError('confirmPassword')) { <div class="invalid-feedback">{{ getFieldError('confirmPassword') }}</div> }
                </div>
                <div class="col-8">
                <input type="password" id="confirmPassword" class="form-control form-control"
                  [class.is-invalid]="(!isEditMode || showPasswordChange) && getFieldError('confirmPassword')"
                  formControlName="confirmPassword" maxlength="100" placeholder="Re-enter password">
                </div>
                </div>
              </div>
            </div>
            @if (isEditMode) {
              <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn submit-button" (click)="onChangePassword()" [disabled]="isSubmitting">
                  Change Password
                </button>
              </div>
            }
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-end gap-2 py-3">
        <button type="button" class="btn btn-dark" (click)="onCancel()" [disabled]="isSubmitting">
          <ng-icon name="tablerArrowLeft" class="me-1" size="16"></ng-icon>
          Back to List
        </button>
        <button type="submit" class="btn submit-button">
          @if (isSubmitting) {
          <span class="spinner-border spinner-border-sm me-1" role="status"></span>
          Saving...
          } @else {
          <ng-icon name="tablerDeviceFloppy" class="me-1" size="16"></ng-icon>
          {{ isEditMode ? 'Update User' : 'Save User' }}
          }
        </button>
      </div>
    </div>

  </form>
</div>